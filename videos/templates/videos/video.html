{% extends 'base.html' %}
{% load humanize %}

{% block content %}

<div class="row" >
    <div class="col-md-8" style="padding-right:12px;">
        
        <div class="card" style="background-color: #000000;">
            <video width="100%" height="500"  autoplay>
                <source src="{{ video.path.url }}" type="video/mp4">
                  Your browser does not support the video tag.
            </video>
        </div>

        <div class="card" style="background-color: #424242;">
            
            <!-- <div class="image-fluid" style="width: 100%;">
                <video
                    style="object-fit: fill;"
                    id="my-video"
                    class="video-js vjs-theme-sea vjs-big-play-centered"
                    controls
                    preload="auto"
                    width="100%"
                    height="auto"
                    poster=""
                    data-setup="{}">
                    <source src="{{ video.path.url }}" type="video/mp4" />
                    <source src="MY_VIDEO.webm" type="video/webm" />
                    <p class="vjs-no-js">
                    To view this video please enable JavaScript, and consider upgrading to a
                    web browser that
                    <a href="https://videojs.com/html5-video-support/" target="_blank"
                        >supports HTML5 video</a
                    >
                    </p>
                </video>
            </div> -->
                
           
            
            <div class="card-body" >
                
                <div class="container" style="padding: 0.4px; margin-bottom: 3px;">
                    
                    <!-- <img src="mypic.jpg" style="width: 750px; height: 480px;"> -->
                    <h4 style="margin-top: 10px; color: #fff; font-weight: 500;">{{video.title}}</h4>
                    <div class="container" style="padding-left: 0px; display: flex;">
                        <div>
                            <p style="margin: 0px; color: #fff;">456,455 views . Feb 25,2020</p>
                        </div>
                                    {% if request.user.is_authenticated %}
                                    <div style="margin-left: 25px;">
                                    <a href="#" onclick="likeVid('{% url 'videos:video_unlike' video.id %}','{{ video.id }}','0'); return false;" 
                                        {% if video.id not in video_likes %} style="display: none;" {% endif %}
                                        id="like_btn_{{video.id}}"
                                    >
                                        <span class="fa-stack" style="vertical-align: middle;">
                                            <i class="fa fa-thumbs-up fa-stack-1x" style="padding-left: 0px; color: blue;"></i>
                                            <i class="fa fa-thumbs-o-up fa-stack-1x" style="display: none; color: white;" ></i>
                                        </span>
                                    </a>
                                    
                                    <a href="#" onclick="likeVid('{% url 'videos:video_like' video.id %}','{{ video.id }}','1'); return false;" 
                                        {% if video.id in video_likes %} style="display: none;" {% endif %}
                                        id="unlike_btn_{{video.id}}"
                                    >
                                        <span class="fa-stack" style="vertical-align: middle;">
                                            <i class="fa fa-thumbs-up fa-stack-1x" style="display: none; color: blue;"></i>
                                            <i class="fa fa-thumbs-o-up fa-stack-1x" style="color: white;"></i>
                    
                                        </span>
                    
                                    </a>
                                    
                                    <span id="like_count" style="color: #fff;">{{like_count}}</span>


                                    <!-- unlike button -->

                                    <span class="fa-stack" style="vertical-align: middle; display: none;">
                                        <i class="fa fa-thumbs-down fa-stack-1x"></i>
                                        <i class="fa fa-thumbs-o-down fa-stack-1x"></i>
                                    </span>
                                    <span class="fa-stack" style="vertical-align: middle;">
                                        <i class="fa fa-thumbs-down fa-stack-1x" ></i>
                                        <i class="fa fa-thumbs-o-down fa-stack-1x"></i>
                                    </span>
                                    <span style="color: #fff;">2.5K</span>
                                    </div>
                                    {% endif %}

                    </div>
                    <hr style="margin-top: 0px;">
                    <div class="container" style="padding-left: 0px;">
                        <div class="container" style="padding-left: 0px; margin-bottom: 20px;" >
                            <h6 style="color: #fff; font-weight: 500;">
                                {{video.hord}}
                            </h6>
                        </div>
                        <p style="color: #fff; font-weight: 500;">
                            {{video.description}}
                            
                        </p>
                    </div>
                        
                    <!-- edit icon <i class="bi bi-pencil"></i> -->
                    <!-- delete icon <i class="bi bi-trash"></i> -->
                                    
                                
                    
                </div>
         
            </div>
        </div>
        <hr>
        <div class="card" style="background-color:#424242;">
            <div class="card-body" >
                <h4 style="color: #fff; font-weight: 500;">Comments</h4>
                <div class="container" id="comment_form" style="padding: 0px">
                    <form id="comment-form" action="">
                        <input  type="text" name="comment-text" id="comment-input" placeholder="Type a comment" >
                        <input type="hidden" name="video-id" value="{{video.id}}">
                        <div style="margin-top: 8.5px;">
                            <!-- <a  id="comment-btn">Submit</a> -->
                            <button class="btn btn-secondary btn-sm" id="comment-btn" type="submit">Submit</button>
                        </div>
                    </form>
                </div>
                <!-- <div>
                    <div class="form-outline mb-4">
                        <textarea
                          class="form-control"
                          id="form4Example3"
                          rows="4"
                        ></textarea>
                        <label
                          class="form-label"
                          for="form4Example3"
                          style="margin-left: 0px"
                          >Message</label
                        >
                        <div class="form-notch">
                          <div class="form-notch-leading" style="width: 9px"></div>
                          <div class="form-notch-middle" style="width: 60px"></div>
                          <div class="form-notch-trailing"></div>
                        </div>
                      </div>
                </div> -->
                <hr>
                <div class="container" style="padding: 0 4px; margin-bottom: 3px;" >
                    <ul class="list-unstyled" id="comment-list">
                        
                            
                            
                                {% if comments %}
                                {% for comment in comments %}
                                        <li class="comment-container{{comment.id}}" style="margin: 0px; padding: 0px;">
                                            <span style=" margin-bottom: 0px;" id="{{comment.id}}-comment-span">
                                                <p style="margin: 0px; color: #fff;" name="comment-user" >
                                                    {{comment.user}}
                                                </p>
                                                {% if comment.user == user %}
                                                    <!-- <a href="#" onclick="editComment({{comment.id}})" data-bs-toggle="modal" data-bs-target="#CommentModal" style="margin-right: 10px; margin-left: 10px;"><i class="bi bi-pencil"></i></a> -->
                                                    <!-- <button type="button" class="btn btn-secondary" id="getComment" data-bs-toggle="modal" data-bs-target="#commentModal" onclick="editComment('{{comment.id}}')" ><i class="bi bi-pencil"></i></button> -->
                                                    <!-- <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#DeleteCommentModal" onclick="deleteComment('{{comment.id}}')"><i class="bi bi-trash"></i></button> -->

                                                    <a  href="#" id="getComment" data-bs-toggle="modal" data-bs-target="#commentModal" onclick="editComment('{{comment.id}}')" ><i class="bi bi-pencil"></i></a>
                                                    <a  href="#" data-bs-toggle="modal" data-bs-target="#DeleteCommentModal" onclick="deleteComment('{{comment.id}}')"><i class="bi bi-trash"></i></a>
                                                    <!-- <a href="#"><i class="bi bi-trash"></i></a> -->
                                                {% endif %}
                                                <p style="margin: 0px; font-size: 9px;" name="comment-date" >{{comment.date_uploaded|naturaltime }}</p>
                                                <p class="CommentText" style=" margin-bottom: 0px; color: #fff;" name="comment-text">
                                                    {{comment.c_text}}
                                                </p>
                                            </span>
                                            <div class="container" style="padding: 0px; margin-bottom: 7.5px; margin-top: 5px;">
                                                <!-- like button -->
                                                <span class="fa-stack" style="vertical-align: middle;">
                                                    <i class="far fa-thumbs-up fa-stack-1x" style="padding-left: 0px;"></i>
                                                    <i class="fas fa-thumbs-up fa-stack-1x"></i>
                            
                                                </span>
                                                <span class="fa-stack" style="vertical-align: middle; display: none;">
                                                    <i class="far fa-thumbs-up fa-stack-1x"></i>
                                                    <i class="fas fa-thumbs-up fa-stack-1x"></i>
                            
                                                </span>
                                                <span>2.5K</span>
                                                <!-- unlike button -->
            
                                                <span class="fa-stack" style="vertical-align: middle; display: none;">
                                                    <i class="far fa-thumbs-down fa-stack-1x"></i>
                                                    <i class="fas fa-thumbs-down fa-stack-1x"></i>
                                                </span>
                                                <span class="fa-stack" style="vertical-align: middle;">
                                                    <i class="far fa-thumbs-down fa-stack-1x"></i>
                                                    <i class="fas fa-thumbs-down fa-stack-1x"></i>
                                                </span>
                                                <span>2.5K</span>
                                                {% if request.user.is_authenticated%}
                                                <a id="reply_btn" style="margin-left: 25px;" onclick="replyFunction('{{comment.id}}')"><i class="bi bi-reply" style="font-size: 1.3rem; color: black;" ></i></a>
                                                {% else %}
                                                <a href="{% url 'login' %}?next={% url 'videos:video_detail' video.id %}" id="reply_btn" style="margin-left: 25px;" ><i class="bi bi-reply" style="font-size: 1.3rem; color: black;" ></i></a>
                                                {% endif %}
                                                <a onclick="my_Function('{{comment.id}}')" style="margin-left: 20px; color: #fff;">
                                                    View replys
                                                </a> <!-- "onclick="my_Function()" href="#" style="margin-left: 20px;">View replys</a> -->
                                        
                                            </div>
                                            <div class="container" id="reply_form{{comment.id}}" style="display: none;">
                                                <form action="" id="reply-form" name="reply-form">
                                                    <input type="hidden" name="reply-comment-id" id="reply-comment-id{{comment.id}}" value="{{comment.id}}">
                                                    <input class="form-control form-control-sm" type="text" name="reply-comment-input" placeholder="Type a reply" id="reply-comment-input{{comment.id}}" >
                                                    <div style="margin-top: 8.5px;">
                                                        <button type="submit" class="btn btn-secondary btn-sm" id="reply_btn">Submit</button>
                                                        <a class="btn btn-secondary btn-sm" type="reset" onclick="replyFunction('{{comment.id}}')" >Cancel</a>
                                                    </div>
                                                </form>
                                                
                                                
                                            </div>

                                            <div id="reply-container{{comment.id}}">
                                            
                                                <div id="reply_container{{comment.id}}" style="display: none;">
                                                    
                                                    <ul class="list-unstyled" id="Reply_container{{comment.id}}" style="margin-left: 20px; margin-right: 4.5px;">
                                                        {% if comment.reply_set.all %}
                                                        {% for reply in comment.reply_set.all %}
                                                            <li id="container_reply_{{comment.id}}">
                                                                <div class="container" style="margin: 0px; padding: 0px;">
                                                                    <p style="margin: 0px;">
                                                                        {{reply.user}}
                                                                        <a  href="#" id="getComment" data-bs-toggle="modal" data-bs-target="#commentModal" onclick="editReply('{{reply.id}}')" ><i class="bi bi-pencil"></i></a>
                                                                        <a  href="#" data-bs-toggle="modal" data-bs-target="#DeleteCommentModal" onclick="deleteReply('{{reply.id}}')"><i class="bi bi-trash"></i></a>
                                                                    </p>
                                                                    <p style="margin: 0px; font-size: 9px;">{{reply.date_uploaded|naturaltime}}</p>
                                                                </div>
                                                                <div class="container" id="{{reply.id}}-reply-container" style="margin: 0px; padding: 0px;">
                                
                                                                    <p class="ReplyText">
                                                                    {{reply.r_text}}
                                                                    </p>
                                                                    <div class="container" style=" margin-bottom: 7.5px; padding: 0px;">
                                                                        <!-- like button -->
                                                                        <span class="fa-stack" style="vertical-align: middle;">
                                                                            <i class="far fa-thumbs-up fa-stack-1x"></i>
                                                                            <i class="fas fa-thumbs-up fa-stack-1x"></i>
                                                    
                                                                        </span>
                                                                        <span class="fa-stack" style="vertical-align: middle; display: none;">
                                                                            <i class="far fa-thumbs-up fa-stack-1x"></i>
                                                                            <i class="fas fa-thumbs-up fa-stack-1x"></i>
                                                    
                                                                        </span>
                                                                        <span>2.5K</span>
                                                                        <!-- unlike button -->
                                
                                                                        <span class="fa-stack" style="vertical-align: middle; display: none;">
                                                                            <i class="far fa-thumbs-down fa-stack-1x"></i>
                                                                            <i class="fas fa-thumbs-down fa-stack-1x"></i>
                                                                        </span>
                                                                        <span class="fa-stack" style="vertical-align: middle;">
                                                                            <i class="far fa-thumbs-down fa-stack-1x"></i>
                                                                            <i class="fas fa-thumbs-down fa-stack-1x"></i>
                                                                        </span>
                                                                        <span>2.5K</span>
                                
                                
                                                                        <a href="#" id="reply_btn" style="margin-left: 25px;"><i class="bi bi-reply" style="font-size: 1.3rem; color: black;" ></i></a>
                                                                        <a href="#" style="margin-left: 20px;">View replys</a>
                                                                    </div>
                                                                    
                                                                </div>
                                                            </li>
                                                        {% endfor %}
                                                        {% else %}
                                                        <li id="container_reply_{{comment.id}}">
                                                            <h6>No replys here</h6>
                                                        </li>
                                                        {% endif %}  
                                                    </ul>
                                                    
                                                </div>
                                            
                                            </div>
                                            <hr>
                                        </li>
                                        
                                        
                                    
                                {% endfor %}
                                {% endif %}

                        
                            
                        
                    </ul>
                    
                </div>
         
            </div>
        </div>
    </div>
    <div class="col-md-4" style="padding: 0;">
        <div class="row" >
            
            <div class="col" >
                {% for video in video_list %}
                <div class="card" style="margin: 0px; background-color: #424242; width: auto;">
                    <img class="thumbnail-image" src="http://unsplash.it/650/250?random={{video.id}}" alt="">
                <div class="card-body" style="margin: 0px;" >
                    <!-- <div class="container" style="margin: 0px 0px 3px 0px;">
                        <a href="{% url 'videos:video_detail' video.id %}" class="thumbnail" video-duration="12:15">
                            <img class="thumbnail-image" src="http://unsplash.it/390/250?gravity=center" alt="">
                        </a>
                    </div> -->
                    <ul class="list-unstyled">
                        <li>
                            <a href="{% url 'videos:video_detail' video.id %}" >
                                <b>{{video.title}}</b>
                            </a>
                        </li>
                        <li>{{video.hord}}</li>
                        <li>{{video.date_uploaded}}</li>
                    </ul>
                </div>
            </div>
            {% endfor %}

            </div>
        </div>
    </div>


    

</div>
<!-- Edit Comment Modal -->
<div class="modal fade" id="commentModal" aria-labelledby="centermodal" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" >
        <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="edit-comment-reply-modal-title"></h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form id="update-Comment-form" action="" >
                  <input type="hidden" name="edit-comment-id" id="edit-comment-id">
                  <div class="container">
                    <label for="message-text" class="col-form-label" id="edit-modal-message-text"></label>
                    <textarea class="form-control" name="edit-comment-text" id="edit-comment-text"></textarea>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Save changes</button>
                  </div>
              </form>
            </div>
            
        </div>
    </div>
</div>
<!-- Delete comment Modal -->
<div class="modal fade" id="DeleteCommentModal" aria-labelledby="centermodal" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" >
        <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="delete-comment-reply-modal-title"></h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form action="" id="delete-Comment-form">
                    <div class="container" id="confirm-Delete-Comment">
                        <input type="hidden" name="delete-comment-id" id="delete-comment-id">
                        <label for="message-text" class="col-form-label" id="delete-modal-message-text"></label>
                        <p name="delete-comment-text" id="delete-comment-text"></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button type="submit" class="btn btn-danger">DELETE</button>
                    </div>
                </form>
             
              
            </div>
            
        </div>
    </div>
</div>
{% endblock %}
{% block javascript %}
<script src="https://vjs.zencdn.net/7.14.3/video.min.js"></script>
<script>
    // var myModal = document.getElementById('CommentModal')
    // var myInput = document.getElementById('getComment')

    // myModal.addEventListener('shown.bs.modal', function () {
    // myInput.focus()
    // })

console.log("Im in the javascript block")
console.log("passed")
          /* When the user clicks on the button,
toggle between hiding and showing the dropdown content */
function myFunction(id) {
         console.log("im in my_function")
         x = document.getElementById("myDropdown");
         if (x.style.display === "none") {
           x.style.display = "block";
         } else {
           x.style.display = "none";
         }
       }

       
       function my_Function(id) {
         var x = document.getElementById("reply_container"+id);
         console.log("im in my_function")
         if (x.style.display === "none") {
           x.style.display = "block";
         } else {
           x.style.display = "none";
         }
       }

       function replyFunction(id) {
         console.log(id)
         var x = document.getElementById("reply_form"+id);
         console.log("im in replyfunction")
         if (x.style.display === "none") {
           x.style.display = "block";
         } else {
           x.style.display = "none";
         }
       }
    

    

       function likeVid(url, video_id,chk) {
            console.log('Requesting JSON');
            $.post(url, {},  function(rowz){
                console.log(url, 'finished');
                $("#unlike_btn_"+video_id).toggle();
                $("#like_btn_"+video_id).toggle();
                if(chk=='1'){
                    $('#like_count').html(function(i, val) { return +val+1 });
                }else{
                    $('#like_count').html(function(i, val) { return +val-1 });
                }
            }).fail(function(xhr) {
                alert('Url failed with '+xhr.status+' '+url);
            });
        }

    
    //########################################################
    $("form#comment-form").submit(function() {
    var commentInput = $('input[name="comment-text"]').val().trim();
    var video_id = $('input[name="video-id"]').val()
    console.log(video_id)
    if (commentInput) {
        // Create Ajax Call
        $.ajax({
            url: '{% url "videos:create_comment" %}',
            data: {
                'comment': commentInput,
                'vid_id': video_id
            },
            dataType: 'json',
            success: function (data) {
                if (data.comment) {
                    console.log(data.comment)
                  appendToCommentdiv(data.comment);
                }
            }
        });
      } else {
        alert("All fields must have a valid value.");
    }
    $('form#comment-form').trigger("reset");
    return false;
});

function appendToCommentdiv(comment) {
  $("#comment-list").prepend(`
  <li class="comment-container${comment.id}" style="margin: 0px; padding: 0px;">
                                            <span style=" margin-bottom: 0px;" id="${comment.id}-comment-span">
                                                <p style="margin: 0px;" name="comment-user" >
                                                    ${comment.user}
                                                </p>
                                                    <!-- <a href="#" onclick="editComment({{comment.id}})" data-bs-toggle="modal" data-bs-target="#CommentModal" style="margin-right: 10px; margin-left: 10px;"><i class="bi bi-pencil"></i></a> -->
                                                    <a  href="#" id="getComment" data-bs-toggle="modal" data-bs-target="#commentModal" onclick="editComment(${comment.id})" ><i class="bi bi-pencil"></i></a>
                                                    <a  href="#" data-bs-toggle="modal" data-bs-target="#DeleteCommentModal" onclick="deleteComment(${comment.id})"><i class="bi bi-trash"></i></a>
                                                    <!-- <a href="#"><i class="bi bi-trash"></i></a> -->
                                                <p style="margin: 0px; font-size: 9px;" name="comment-date" >${comment.uploaded_date }</p>
                                                <p class="CommentText" style=" margin-bottom: 0px;" name="comment-text">
                                                    ${comment.comment_text}
                                                </p>
                                            </span>
                                            <div class="container" style="padding: 0px; margin-bottom: 7.5px; margin-top: 5px;">
                                                <!-- like button -->
                                                <span class="fa-stack" style="vertical-align: middle;">
                                                    <i class="far fa-thumbs-up fa-stack-1x" style="padding-left: 0px;"></i>
                                                    <i class="fas fa-thumbs-up fa-stack-1x"></i>
                            
                                                </span>
                                                <span class="fa-stack" style="vertical-align: middle; display: none;">
                                                    <i class="far fa-thumbs-up fa-stack-1x"></i>
                                                    <i class="fas fa-thumbs-up fa-stack-1x"></i>
                            
                                                </span>
                                                <span>2.5K</span>
                                                <!-- unlike button -->
            
                                                <span class="fa-stack" style="vertical-align: middle; display: none;">
                                                    <i class="far fa-thumbs-down fa-stack-1x"></i>
                                                    <i class="fas fa-thumbs-down fa-stack-1x"></i>
                                                </span>
                                                <span class="fa-stack" style="vertical-align: middle;">
                                                    <i class="far fa-thumbs-down fa-stack-1x"></i>
                                                    <i class="fas fa-thumbs-down fa-stack-1x"></i>
                                                </span>
                                                <span>2.5K</span>
                                                {% if request.user.is_authenticated%}
                                                <a id="reply_btn" style="margin-left: 25px;" onclick="replyFunction(${comment.id})"><i class="bi bi-reply" style="font-size: 1.3rem; color: black;" ></i></a>
                                                {% else %}
                                                <a href="{% url 'login' %}?next={% url 'videos:video_detail' video.id %}" id="reply_btn" style="margin-left: 25px;" ><i class="bi bi-reply" style="font-size: 1.3rem; color: black;" ></i></a>
                                                {% endif %}
                                                <a onclick="my_Function(${comment.id})" style="margin-left: 20px;">
                                                    View replys
                                                </a> <!-- "onclick="my_Function()" href="#" style="margin-left: 20px;">View replys</a> -->
                                        
                                            </div>
                                            <div class="container" id="reply_form${comment.id}" style="display: none;">
                                                <form action="" id="reply-form" name="reply-form">
                                                    <input type="hidden" name="reply-comment-id" id="reply-comment-id${comment.id}" value="${comment.id}">
                                                    <input class="form-control form-control-sm" type="text" name="reply-comment-input" placeholder="Type a reply" id="reply-comment-input${comment.id}" >
                                                    <div style="margin-top: 8.5px;">
                                                        <button type="submit" class="btn btn-secondary btn-sm" id="reply_btn">Submit</button>
                                                        <button class="btn btn-secondary btn-sm" onclick="replyFunction(${comment.id})" >Cancel</button>
                                                    </div>
                                                </form>
                                                
                                                
                                            </div>

                                            <div id="reply-container${comment.id}">
                                            
                                                <div id="reply_container${comment.id}" style="display: none;">
                                                    
                                                    <ul class="list-unstyled" id="Reply_container${comment.id}" style="margin-left: 20px; margin-right: 4.5px;">
                                                        <li style="display: none;"></li>
                                                    </ul>
                                                    
                                                </div>
                                            
                                            </div>
                                            <hr>
                                        </li>
    `);
}


function editComment(id) {
  if (id) {
    sp_id = "#"+id+"-comment-span";
    console.log(sp_id)
    
    comment = $(sp_id).find(".CommentText").text().trim();
    console.log(id)
    console.log(comment)
    $('#edit-comment-reply-modal-title').text("EDIT COMMENT")
    $('#edit-modal-message-text').text("Comment:")
    $('#edit-comment-id').val(id);
    $('#edit-comment-text').val(comment);

  }
}

function deleteComment(id){
    if(id){
        sp_id = "#"+id+"-comment-span";
        console.log(sp_id)
    
        comment = $(sp_id).find(".CommentText").text().trim();
        $('#delete-comment-reply-modal-title').text("DELETE COMMENT")
        $('#delete-modal-message-text').text("Comment:")
        $('#delete-comment-id').val(id);
        $('#delete-comment-text').text(comment);
    }
}

$("form#update-Comment-form").submit(function() {
    var idInput = $('input[name="edit-comment-id"]').val();
    var commentInput = $('textarea[name="edit-comment-text"]').val().trim();
    console.log(commentInput)
    console.log(idInput)
    if (commentInput) {
        // Create Ajax Call
        $.ajax({
            url: '{% url "videos:update_comment" %}',
            data: {
                'id': idInput,
                'comment': commentInput
            },
            dataType: 'json',
            success: function (data) {
                if (data.comment) {
                  updateToComment(data.comment);
                }
            }
        });
       } else {
        alert("All fields must have a valid value.");
    }
    $('form#update-Comment-form').trigger("reset");
    $('#commentModal').modal('hide');
    return false;
});


$("form#delete-Comment-form").submit(function() {
    var idInput = $('input[name="delete-comment-id"]').val();
    console.log(idInput)
    if (idInput) {
        // Create Ajax Call
        $.ajax({
            url: '{% url "videos:delete_comment" %}',
            data: {
                'id': idInput
            },
            dataType: 'json',
            success: function (data) {
                if (data.success_message) {
                  $(".comment-container"+data.comment_id).remove()
                  console.log(data.success_message)
                }
            }
        });
       } else {
        alert("All fields must have a valid value.");
    }
    $('form#delete-Comment-form').trigger("reset");
    $('#DeleteCommentModal').modal('hide');
    return false;
});




function updateToComment(comment){
    console.log("inside updateToComment function")
    $("#"+comment.id+"-comment-span").children("p").each(function() {
        var attr = $(this).attr("name");
        var attrs = $(this).text();
        console.log(attrs)
        if (attr == "comment-user") {
          $(this).text(comment.user);
        } else if (attr == "comment-date") {
          $(this).text(comment.updated_date);
        } else {
          $(this).text(comment.comment_text);
        }
      });
}

// Reply ajax fuunctions


$('form#reply-form').submit(function(){
    // var comment_id = $('input[name="reply-comment-id"]').val()
    var attr_id = $(this).children('input:first-child').val()
    console.log(attr_id)
    var comment_id = attr_id
    var reply_text = $("#reply-comment-input"+comment_id).val()
    console.log(reply_text)
    console.log(comment_id)
    if(reply_text){
        $.ajax({
            url: '{% url "videos:create_reply" %}',
            data: {
                'comment_id': comment_id,
                'reply': reply_text
            },
            dataType: 'json',
            success: function (data) {
                if (data.reply) {
                  console.log(data.reply.comment_id)
                  appendToReplydiv(data.reply);
                  
                }
            }
        });
    }else{
        alert("All fields must have a valid value")
    }
    $('form#reply-form').trigger("reset");
    return false;
})

// function ajxreply(){
    
// }

function appendToReplydiv(reply){
    $('#Reply_container'+reply.comment_id).append(`
    <li id="container_reply_${reply.comment_id}">
                                                                <div class="container" style="margin: 0px; padding: 0px;">
                                                                    <p style="margin: 0px;" name="reply-user">
                                                                        ${reply.user}
                                                                        <a  href="#" id="getComment" data-bs-toggle="modal" data-bs-target="#commentModal" onclick="editReply(${reply.id})" ><i class="bi bi-pencil"></i></a>
                                                                        <a  href="#" data-bs-toggle="modal" data-bs-target="#DeleteCommentModal" onclick="deleteReply(${reply.id})"><i class="bi bi-trash"></i></a>
                                                                    </p>
                                                                    <p style="margin: 0px; font-size: 9px;" name="reply-date">${reply.uploaded_date}</p>
                                                                </div>
                                                                <div class="container" id="${reply.id}-reply-container" style="margin: 0px; padding: 0px;">
                                
                                                                    <p class="ReplyText">
                                                                    ${reply.reply}
                                                                    </p>
                                                                    <div class="container" style=" margin-bottom: 7.5px; padding: 0px;">
                                                                        <!-- like button -->
                                                                        <span class="fa-stack" style="vertical-align: middle;">
                                                                            <i class="far fa-thumbs-up fa-stack-1x"></i>
                                                                            <i class="fas fa-thumbs-up fa-stack-1x"></i>
                                                    
                                                                        </span>
                                                                        <span class="fa-stack" style="vertical-align: middle; display: none;">
                                                                            <i class="far fa-thumbs-up fa-stack-1x"></i>
                                                                            <i class="fas fa-thumbs-up fa-stack-1x"></i>
                                                    
                                                                        </span>
                                                                        <span>2.5K</span>
                                                                        <!-- unlike button -->
                                
                                                                        <span class="fa-stack" style="vertical-align: middle; display: none;">
                                                                            <i class="far fa-thumbs-down fa-stack-1x"></i>
                                                                            <i class="fas fa-thumbs-down fa-stack-1x"></i>
                                                                        </span>
                                                                        <span class="fa-stack" style="vertical-align: middle;">
                                                                            <i class="far fa-thumbs-down fa-stack-1x"></i>
                                                                            <i class="fas fa-thumbs-down fa-stack-1x"></i>
                                                                        </span>
                                                                        <span>2.5K</span>
                                
                                
                                                                        <a href="#" id="reply_btn" style="margin-left: 25px;"><i class="bi bi-reply" style="font-size: 1.3rem; color: black;" ></i></a>
                                                                        <a href="#" style="margin-left: 20px;">View replys</a>
                                                                    </div>
                                                                    
                                                                </div>
                                                            </li>
    `)
}




function editReply(id) {
  if (id) {
    sp_id = "#"+id+"-reply-container";
    console.log(sp_id)
    
    comment = $(sp_id).find(".ReplyText").text().trim();
    console.log(id)
    console.log(comment)
    $('#edit-comment-reply-modal-title').text("EDIT REPLY")
    $('#edit-modal-message-text').text("Reply:")
    $('#edit-comment-id').val(id);
    $('#edit-comment-text').val(comment);

  }
}

function deleteReply(id){
    if(id){
        sp_id = "#"+id+"-reply-container";
        console.log(sp_id)
    
        comment = $(sp_id).find(".ReplyText").text().trim();
        $('#delete-comment-reply-modal-title').text("DELETE REPLY")
        $('#delete-modal-message-text').text("Reply:")
        $('#delete-comment-id').val(id);
        $('#delete-comment-text').text(comment);
    }
}

$("form#update-Comment-form").submit(function() {
    var idInput = $('input[name="edit-comment-id"]').val();
    var commentInput = $('textarea[name="edit-comment-text"]').val().trim();
    console.log(commentInput)
    console.log(idInput)
    if (commentInput) {
        // Create Ajax Call
        $.ajax({
            url: '{% url "videos:update_reply" %}',
            data: {
                'id': idInput,
                'reply': commentInput
            },
            dataType: 'json',
            success: function (data) {
                if (data.reply) {
                  updateToReply(data.reply);
                }
            }
        });
       } else {
        alert("All fields must have a valid value.");
    }
    $('form#update-Reply-form').trigger("reset");
    $('#commentModal').modal('hide');
    return false;
});

function updateToReply(reply){
    console.log("inside updateToComment function")
    $("#"+reply.id+"-reply-container").children("p").each(function() {
        var attr = $(this).attr("name");
        var attrs = $(this).text();
        console.log(attrs)
        if (attr == "reply-user") {
          $(this).text(reply.user);
        } else if (attr == "comment-date") {
          $(this).text(reply.updated_date);
        } else {
          $(this).text(reply.reply_text);
        }
      });
}


$("form#delete-Comment-form").submit(function() {
    var idInput = $('input[name="delete-comment-id"]').val();
    console.log(idInput)
    if (idInput) {
        // Create Ajax Call
        $.ajax({
            url: '{% url "videos:delete_reply" %}',
            data: {
                'id': idInput
            },
            dataType: 'json',
            success: function (data) {
                if (data.success_message) {
                  $(".comment-container"+data.comment_id).remove()
                  console.log(data.success_message)
                }
            }
        });
       } else {
        alert("All fields must have a valid value.");
    }
    $('form#delete-Reply-form').trigger("reset");
    $('#DeleteCommentModal').modal('hide');
    return false;
});







</script>

{% endblock javascript %}